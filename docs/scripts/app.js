const t="state",e=Symbol(),s=Symbol(),n=Symbol(),o=Symbol(),i=Symbol(),c=Symbol(),a=Symbol();function r(r,d){return class extends d{constructor(...t){super(...t),this[a]=this[a].bind(this),this[s]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this[n](),this[i]()}disconnectedCallback(){this[c](),this[o](),super.disconnectedCallback&&super.disconnectedCallback()}[s](){if(this[e]={},this.mapEvents){const t=this.mapEvents();for(const s in t)this[e][s]=e=>r.dispatch(t[s](e))}}[n](){for(const t in this[e])this.addEventListener(t,this[e][t],!1)}[o](){for(const t in this[e])this.removeEventListener(t,this[e][t],!1)}[i](){r.addEventListener(t,this[a]),this[a]()}[c](){this.removeEventListener(t,this[a])}[a](){this.mapState&&Object.assign(this,this.mapState(r.state))}}}const d=t=>t,l=(t,e)=>e.indexOf("/")>-1?e:t+"/"+e,h=(t,e,s)=>{const n=l(e,s);return t.dispatcher[e][s]=e=>{const s={type:n,...e&&{payload:e}};return t.dispatch(s)},n},u="dispatch",p="state";class m extends EventTarget{constructor(t,e){super(),this.state=t,this.reducer=e,this.state=this.reducer(this.state,{})}dispatch(t){const e=new CustomEvent(u,{cancelable:!0,detail:{action:t}});return this.dispatchEvent(e)&&(t=e.detail.action,this.state=this.reducer(this.state,t),this.dispatchEvent(new CustomEvent(p,{detail:{action:t}}))),t}}const f=[{onInit(){this.dispatcher={}},onModel(t,e){this.dispatcher[t]={};for(const s in e.reducers)h(this,t,s)}},{onInit(){this.effects={}},onModel(t,e){if(!e.effects)return;const s=this.dispatcher[t];for(const n in e.effects){const o=h(this,t,n),i=e.effects[n].bind(s),c=(t,e,s)=>i(t,e,s);this.effects[o]?this.effects[o].push(c):this.effects[o]=[c]}},onStore(t){t.addEventListener("state",async e=>{const{action:s}=e.detail,n=this.effects[s.type];n&&await Promise.all(n.map(e=>e(s.payload,t.state,t.dispatch)))})}}],g=t=>{const e=[];return t=t.replace(/[\-{}\[\]+?.,\\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,(t,s)=>(e.push(t.slice(1)),s?t:"([^/?]+)")).replace(/\*/g,()=>(e.push("path"),"([^?]*?)")),[new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$"),e]};const v=(t=>{const e=Object.keys(t),s=[];return n=>{for(let o=0;o<e.length;o++){const i=e[o];let c=s[o];c||(c=g(i),s[o]=c);const a=c[0].exec(n);if(a){const e=a.slice(1,-1).reduce((t,e,s)=>(void 0!==e&&(t[c[1][s]]=e),t),{});return{page:t[i],params:e}}}return null}})({"/":"home-view","/blog":"blog-view","/todos":"todos-view","/todos/:id":"todo-view","/article/:article":"article-view","/counter":"counter-view","/*":"not-found"});var E=d({state:0,reducers:{inc:t=>t+1,dec:t=>t-1}});const w="https://jsonplaceholder.typicode.com/";var S=d({state:{entities:{},ids:[],selected:0,loading:!1},reducers:{select:(t,e)=>({...t,selected:e}),request:t=>({...t,loading:!0}),received:(t,e)=>({...t,entities:{...t.entities,[e.id]:e},loading:!1}),receivedList:(t,e)=>({...t,entities:e.reduce((t,e)=>(t[e.id]=e,t),{}),ids:e.map(t=>t.id),loading:!1})},effects:{async select(t,e){if(!e.todos.entities[e.todos.selected]){this.request();const e=await fetch(`${w}todos/${t}`),s=await e.json();this.received(s)}},async load(t,e){if(!e.todos.ids.length){this.request();const t=await fetch(`${w}todos`),e=await t.json();this.receivedList(e)}},"routing/change":async function(t){switch(t.page){case"todos-view":this.load();break;case"todo-view":this.select(parseInt(t.params.id))}}}});let y=(t=>{const e={},s=[...f,...t.plugins||[]],n={...t.models},o={};s.forEach(t=>{t.state&&(n[t.state.name]=t.state.model),t.onInit&&t.onInit.call(e)});for(const t in n){const i=n[t];s.forEach(s=>{s.onModel&&s.onModel.call(e,t,i)});const c={};for(const e in i.reducers)c[l(t,e)]=i.reducers[e];o[t]=function(t=i.state,e){const s=c[e.type];return s?s(t,e.payload):t}}const i=function(t){return(e={},s)=>{for(const n in t)e[n]=t[n](e[n],s);return e}}(o),c=t&&t.state,a=new m(c,i);return e.dispatch=a.dispatch.bind(a),s.forEach(t=>{t.onStore&&t.onStore.call(e,a)}),a.models=e.dispatcher,a})({models:Object.freeze({__proto__:null,counter:E,todos:S}),plugins:[(t=>({state:{name:"routing",model:d({state:{page:"",params:{}},reducers:{change:(t,e)=>e}}),effects:{push(t){history.pushState(null,"",t),dispatchEvent(new Event("popstate"))},replace(t){history.replaceState(null,"",t),dispatchEvent(new Event("popstate"))}}},onStore(e){!function(t,e){const s=()=>{const s=t(location.pathname);e.routing.change(s)};window.addEventListener("popstate",s),s();const n=t=>{if(t.button&&0!==t.button||t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)return;const e=t.composedPath().find(t=>"A"===t.tagName);if(!e||e.target||e.hasAttribute("download")||"external"===e.getAttribute("rel"))return;const n=e.href;n&&-1===n.indexOf("mailto:")&&(t.preventDefault(),n!==location.href&&(history.pushState(null,"",n),s()))};window.addEventListener("DOMContentLoaded",()=>{window.document.body.addEventListener("click",n)})}(t,this.dispatcher)}}))(v)]});y=function(e){const s=window.__REDUX_DEVTOOLS_EXTENSION__;if(s){const n=s.connect();let o=!1;e.addEventListener(t,t=>{const{action:s}=t.detail;o?o=!1:n.send(s,e.state)}),n.subscribe(t=>{"DISPATCH"===t.type&&t.state&&(o=!0,e.state=JSON.parse(t.state),e.dispatch({}))}),n.init(e.state)}return e}(y=function(e,s){const n={name:location.hostname,filter:t=>!0,persist:t=>t,delay:0,...s},o=localStorage.getItem(n.name);o&&(e.state={...e.state,...JSON.parse(o)});let i=0;return e.addEventListener(t,t=>{const s=t,{action:o}=s.detail;n.filter(o)&&(i&&window.clearTimeout(i),i=window.setTimeout(()=>{localStorage.setItem(n.name,JSON.stringify(n.persist(e.state))),i=0},n.delay))}),e}(y));class b extends(r(y,HTMLElement)){constructor(){super(...arguments),this._page=""}set route(t){if(t.page!==this._page){const e=document.createElement(t.page);this.textContent="",this.appendChild(e),this._page=t.page}}mapState(t){return{route:t.routing}}}customElements.define("app-shell",b);class L extends(r(y,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML=`\n      <button id="dec">-</button>\n      <span id="count">${this.count}</span>\n      <button id="inc">+</button>`,this.el=t.querySelector("#count");const e=t.querySelector("#dec"),s=t.querySelector("#inc");e.addEventListener("click",y.models.counter.dec),s.addEventListener("click",y.models.counter.inc)}set count(t){this.el&&(this.el.textContent=`${t}`)}mapState(t){return{count:t.counter}}}customElements.define("counter-view",L);class x extends(r(y,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML="<style>a{text-decoration:none}a[completed]{text-decoration:line-through}</style><ul id=todos></ul>",this.el=t.querySelector("#todos")}set todos(t){if(this.el&&t.length){const e=document.createDocumentFragment();t.forEach(t=>{const s=document.createElement("li");s.innerHTML=`<a href="/todos/${t.id}" ${t.completed?"completed":""}>${t.title}</a>`,e.appendChild(s)}),this.el.textContent="",this.el.appendChild(e)}}set loading(t){if(this.el&&t){this.el.textContent="";const t=document.createElement("li");t.textContent="Loading ...",this.el.appendChild(t)}}mapState(t){return{loading:t.todos.loading,todos:t.todos.ids.map(e=>t.todos.entities[e])}}}customElements.define("todos-view",x);class C extends(r(y,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML='<pre id="todo"></pre>',this.el=t.querySelector("#todo")}set todo(t){this.el&&t&&(this.el.textContent=JSON.stringify(t,null,"  "))}set loading(t){this.el&&t&&(this.el.textContent="Loading ...")}mapState(t){return{loading:t.todos.loading,todo:t.todos.entities[t.todos.selected]}}}function T(t,e){customElements.define(t,class extends HTMLElement{connectedCallback(){this.textContent=e}})}customElements.define("todo-view",C),T("home-view","Home Page"),T("blog-view","Blog Page"),T("not-found","404: Not Found");class M extends(r(y,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML=`Article <span id="article">${this.article}</span>`,this.el=t.querySelector("#article")}set article(t){this.el&&(this.el.textContent=`${t}`)}mapState(t){return{article:t.routing.params.article}}}customElements.define("article-view",M);
//# sourceMappingURL=app.js.map
