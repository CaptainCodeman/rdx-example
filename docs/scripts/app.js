const t="state",e=Symbol(),s=Symbol(),n=Symbol(),o=Symbol(),i=Symbol(),a=Symbol(),c=Symbol();function r(r,d){return class extends d{constructor(...t){super(...t),this[c]=this[c].bind(this),this[s]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this[n](),this[i]()}disconnectedCallback(){this[a](),this[o](),super.disconnectedCallback&&super.disconnectedCallback()}[s](){this[e]=this.mapEvents?this.mapEvents():{}}[n](){for(const t in this[e])this.addEventListener(t,this[e][t],!1)}[o](){for(const t in this[e])this.removeEventListener(t,this[e][t],!1)}[i](){r.addEventListener(t,this[c]),this[c]()}[a](){this.removeEventListener(t,this[c])}[c](){this.mapState&&Object.assign(this,this.mapState(r.state))}}}class d extends EventTarget{constructor(t,e){super(),this.state=t,this.reducer=e,this.state=this.reducer(this.state,{})}dispatch(e){const s=new CustomEvent("action",{cancelable:!0,detail:{action:e}});return this.dispatchEvent(s)&&(e=s.detail.action,this.state=this.reducer(this.state,e),this.dispatchEvent(new CustomEvent(t,{detail:{action:e}}))),e}}const l=(t,e)=>e.indexOf("/")>-1?e:t+"/"+e,u=(t,e,s)=>{const n=l(e,s);return t.dispatch[e][s]=e=>{const s={type:n,...void 0!==e&&{payload:e}};return t.dispatch(s)},n},h={},p=[],m={dispatchPlugin:{onModel(t,e,s){t.dispatch[e]={};for(const n in s.reducers)u(t,e,n)}},effectsPlugin:{onModel(t,e,s){if(!s.effects)return;const n=s.effects({getDispatch:()=>t.dispatch,getState:()=>t.state});for(const s in n){const o=u(t,e,s),i=n[s];h[o]?h[o].push(i):h[o]=[i],"init"===s&&p.push(i)}},onStore(e){e.addEventListener(t,t=>{const{action:e}=t.detail,s=h[e.type];s&&queueMicrotask(()=>s.forEach(t=>t(e.payload)))}),p.forEach(t=>t())}}},g=t=>"DISPATCH"===t.type;const f=window.history,v=()=>dispatchEvent(new Event("popstate")),w=t=>{const e=(t=>t.composedPath().find(t=>"A"===t.tagName))(t);return void 0===e||!e.href.startsWith(document.baseURI)||(t=>t.hasAttribute("download"))(e)||(t=>(t.getAttribute("rel")||"").includes("external"))(e)||(t=>t.target)(e)||(t=>t.button&&0!==t.button||t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)(t)?null:e.href},E=t=>{const e=[];return t=t.replace(/[\-{}\[\]+?.,\\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,(t,s)=>(e.push(t.slice(1)),s?t:"([^/?]+)")).replace(/\*/g,()=>(e.push("path"),"([^?]*?)")),[new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$"),e]};var S={state:0,reducers:{inc:t=>t+1,dec:t=>t-1}};const b="https://jsonplaceholder.typicode.com/";var y={state:{entities:{},ids:[],selected:0,loading:!1},reducers:{select:(t,e)=>({...t,selected:e}),request:t=>({...t,loading:!0}),received:(t,e)=>({...t,entities:{...t.entities,[e.id]:e},loading:!1}),receivedList:(t,e)=>({...t,entities:e.reduce((t,e)=>(t[e.id]=e,t),{}),ids:e.map(t=>t.id),loading:!1})},effects(t){const e=t.getDispatch();return{async select(s){const n=t.getState();if(!n.todos.entities[n.todos.selected]){e.todos.request();const t=await fetch(`${b}todos/${s}`),n=await t.json();e.todos.received(n)}},async load(){if(!t.getState().todos.ids.length){e.todos.request();const t=await fetch(b+"todos"),s=await t.json();e.todos.receivedList(s)}},"routing/change":async function(t){switch(t.page){case"todos-view":e.todos.load();break;case"todo-view":e.todos.select(parseInt(t.params.id))}}}}};let L=(t=>{const e={...t.models},s={...m,...t.plugins};for(const t in s){const n=s[t];n.model&&(e[t]=n.model)}const n={};for(const t in e){const s=e[t],o={};for(const e in s.reducers)o[l(t,e)]=s.reducers[e];n[t]=(t=s.state,e)=>{const n=o[e.type];return n?n(t,e.payload):t}}const o=function(t){return(e={},s)=>{const n={};for(const o in t)n[o]=t[o](e[o],s);return n}}(n),i=t&&t.state,a=new d(i,o);for(const t in s){const n=s[t];if(n.onModel)for(const t in e)n.onModel(a,t,e[t])}for(const t in s){const e=s[t];e.onStore&&e.onStore(a)}return a})({models:Object.freeze({__proto__:null,counter:S,todos:y}),plugins:{routing:((t,e)=>{const s={transform:t=>t,...e};return{model:{state:{page:"",params:{}},reducers:{change:(t,e)=>e},effects:t=>({back(){f.back(),v()},forward(){f.forward(),v()},go(t){f.go(t),v()},push(t){f.pushState(null,"",t),v()},replace(t){f.replaceState(null,"",t),v()}})},onStore(e){const n=e.dispatch.routing,o=()=>{const e=t(location.pathname);e&&n.change(s.transform(e))};window.addEventListener("popstate",o),window.addEventListener("click",t=>{const e=w(t);e&&(t.preventDefault(),f.pushState(null,"",e),v())}),queueMicrotask(o)}}})((t=>{const e=Object.keys(t),s=[];return n=>{for(let o=0;o<e.length;o++){const i=e[o];let a=s[o];a||(a=E(i),s[o]=a);const c=a[0].exec(n);if(c){const e=c.slice(1,-1).reduce((t,e,s)=>(void 0!==e&&(t[a[1][s]]=e),t),{});return{page:t[i],params:e}}}return null}})({"/:app/":"home-view","/:app/blog":"blog-view","/:app/todos":"todos-view","/:app/todos/:id":"todo-view","/:app/article/:article":"article-view","/:app/counter":"counter-view","/:app/*":"not-found"}))}});L=function(e,s){const n=window.__REDUX_DEVTOOLS_EXTENSION__;if(n){const o=n.connect(s);e.addEventListener(t,t=>{const{action:s}=t.detail;g(s)||o.send(s,e.state)}),o.subscribe(s=>{g(s)&&(e.state=JSON.parse(s.state),e.dispatchEvent(new CustomEvent(t,{detail:{action:s}})))}),o.init(e.state)}return e}(L),L=function(e,s){const n={name:location.hostname,storage:localStorage,serializer:JSON,filter:t=>!0,persist:t=>t,delay:0,...s},o=n.storage.getItem(n.name);o&&(e.state={...e.state,...n.serializer.parse(o)});let i=0;return e.addEventListener(t,t=>{const{action:s}=t.detail;n.filter(s)&&(i&&window.clearTimeout(i),i=window.setTimeout(()=>{n.storage.setItem(n.name,n.serializer.stringify(n.persist(e.state))),i=0},n.delay))}),e}(L);const C=L;class x extends(r(C,HTMLElement)){constructor(){super(...arguments),this._page=""}set route(t){if(t.page!==this._page){const e=document.createElement(t.page);this.textContent="",this.appendChild(e),this._page=t.page}}mapState(t){return{route:t.routing}}}customElements.define("app-shell",x);class M extends(r(C,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML=`<button id="dec">-</button> <span id="count">${this.count}</span> <button id="inc">+</button>`,this.el=t.querySelector("#count");const e=t.querySelector("#dec"),s=t.querySelector("#inc");e.addEventListener("click",C.dispatch.counter.dec),s.addEventListener("click",C.dispatch.counter.inc)}set count(t){this.el&&(this.el.textContent=""+t)}mapState(t){return{count:t.counter}}}customElements.define("counter-view",M);class T extends(r(C,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML='<style>a{text-decoration:none}a[completed]{text-decoration:line-through}</style><ul id="todos"></ul>',this.el=t.querySelector("#todos")}set todos(t){if(this.el&&t.length){const e=document.createDocumentFragment();t.forEach(t=>{const s=document.createElement("li");s.innerHTML=`<a href="./todos/${t.id}" ${t.completed?"completed":""}>${t.title}</a>`,e.appendChild(s)}),this.el.textContent="",this.el.appendChild(e)}}set loading(t){if(this.el&&t){this.el.textContent="";const t=document.createElement("li");t.textContent="Loading ...",this.el.appendChild(t)}}mapState(t){return{loading:t.todos.loading,todos:t.todos.ids.map(e=>t.todos.entities[e])}}}customElements.define("todos-view",T);class k extends(r(C,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML='<pre id="todo"></pre>',this.el=t.querySelector("#todo")}set todo(t){this.el&&t&&(this.el.textContent=JSON.stringify(t,null,"  "))}set loading(t){this.el&&t&&(this.el.textContent="Loading ...")}mapState(t){return{loading:t.todos.loading,todo:t.todos.entities[t.todos.selected]}}}function H(t,e){customElements.define(t,class extends HTMLElement{connectedCallback(){this.textContent=e}})}customElements.define("todo-view",k),H("home-view","Home Page"),H("blog-view","Blog Page"),H("not-found","404: Not Found");class _ extends(r(C,HTMLElement)){constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML=`Article <span id="article">${this.article}</span>`,this.el=t.querySelector("#article")}set article(t){this.el&&(this.el.textContent=""+t)}mapState(t){return{article:t.routing.params.article}}}customElements.define("article-view",_);
//# sourceMappingURL=app.js.map
